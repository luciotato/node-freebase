function trytoparse(e){try{return JSON.parse(e)}catch(t){return e}}function freebase(){function t(e,t,n){this.doc="interface to freebase's mql api",this.reference="http://wiki.freebase.com/wiki/MQL",n=n||console.log;if(!e)return n({});typeof t=="function"&&(n=t,t={}),t=t||{},t.uniqueness_failure=t.uniqueness_failure||"soft",t.cursor=t.cursor||!0,fns.post(e,t,function(e){return n(e)})}function n(t,n,r){this.doc="generic info for an id";var i=fns.settle_params(arguments,freebase.lookup,{type:"/common/topic"});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});var s=fns.clone(e.generic_query);s.id=i.q,freebase.mqlread([s],n,function(e){return e=e.result||[],i.callback(e[0]||{})})}function r(t,n,r){this.doc="regular search api",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var i=fns.settle_params(arguments,freebase.search,{});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});if(i.is_id)return freebase.lookup_id(i.q,i.options,i.callback);if(i.url)return freebase.url_lookup(i.q,i.options,function(e){return e&&e.result&&e.result[0]?i.callback(e.result[0]):i.callback({})});if(i.is_id)return i.options.limit=1,freebase.lookup_id(i.q,i.options,i.callback);i.options.query=encodeURIComponent(i.q);var s=fns.set_params(i.options),o=e.host+"search/?"+s;if(i.options.type=="/type/type"||i.options.type=="/type/property")o+="&scoring=schema&stemmed=true";fns.http(o,i.options,function(e){return!e||!e.result||!e.result[0]?i.callback([]):i.callback(e.result)})}function i(t,n,r){this.doc="freebase search tuned for looking up a url",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var i=fns.settle_params(arguments,freebase.url_lookup,{type:"/common/topic",strict:!0});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});var s=fns.clone(e.generic_query),o=e.host+"search?type=/common/topic&limit=1&query="+encodeURIComponent(i.q);o+="&mql_output="+encodeURIComponent(JSON.stringify(s)),fns.http(o,i.options,function(e){if(!e||!e.result)return i.callback({});var t=e.result||[];return i.callback(t[0])})}function s(t,n,r){this.doc="freebase search with filters to ensure only a confident, unambiguous result",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var i=fns.settle_params(arguments,freebase.lookup,{type:"/common/topic",strict:!0});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});if(i.url)return freebase.url_lookup(i.q,i.options,i.callback);if(i.is_id)return i.options.limit=1,freebase.lookup_id(i.q,i.options,i.callback);var s=i.options.strength||"full";i.options.strict||(s="word");var o=e.host+"search?limit=2&lang=en&type="+i.options.type+"&filter=",u=fns.clone(e.generic_query);o+=encodeURIComponent("(any name{"+s+'}:"'+i.q+'" alias{'+s+'}:"'+i.q+'")');if(i.options.type=="/type/type"||i.options.type=="/type/property")o+="&scoring=schema&stemmed=true";return o+="&mql_output="+encodeURIComponent(JSON.stringify(u)),fns.http(o,i.options,function(e){return!e||!e.result||!e.result[0]?i.callback({}):(e=e.result||[],e[0]=e[0]||{},e[1]=e[1]||{},!e[0].score&&e[0].score<30?i.callback({}):i.options.strict&&(e[0].score||0)*.7<(e[1].score||0)?i.callback({}):e[1]&&e[0].notable&&fns.isin(e[0].notable.id,data.kill)?i.callback({}):(e[0].name=e[0].name||e[0].text||"",i.callback(e[0])))})}function o(e,t,n){this.doc="like freebase.lookup but satisfied with an id",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var r=fns.settle_params(arguments,freebase.get_id,{type:"/common/topic"});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});if(!r.q||r.q.match(/\/.{1,32}\/.{3}/)!==null)return r.callback({id:r.q});freebase.lookup(r.q,r.options,function(e){return e?r.options.type=="/type/type"?(e.mid=e.id,r.callback(e)):e.mid?(e.id=e.id||e.mid,r.callback(e)):r.callback({}):r.callback({})})}function u(t,n,r){this.doc="topic api",this.reference="http://wiki.freebase.com/wiki/Topic_API";var i=fns.settle_params(arguments,freebase.topic,{});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});freebase.get_id(i.q,i.options,function(t){var n=t.id;if(!n)return i.callback({});i.options.filter=i.options.filter||"all";var r=e.host+"topic"+n+"?"+fns.set_params(i.options);fns.http(r,i.options,function(e){return i.callback(e)})})}function a(e,t,n){this.doc="get all of the results to your query",this.reference="http://wiki.freebase.com/wiki/MQL",typeof t=="function"&&(n=t,t={}),t=t||{},n=n||console.log,t.max=t.max||2e3;var r=[],i=function(s){t.cursor=s,freebase.mqlread(e,t,function(e){if(!e||!e.result)return n(r);r=r.concat(e.result);if(!e.cursor||!(!t.max||r.length<t.max))return n(r);i(e.cursor)})};i("")}function f(t,n,r){this.doc="get a text blurb from freebase",this.reference="http://wiki.freebase.com/wiki/ApiText";var i=fns.settle_params(arguments,freebase.description,{});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});freebase.get_id(i.q,i.options,function(t){if(!t||!t.id)return i.callback("");var n=e.host+"text/"+t.id;fns.http(n,i.options,function(e){return e.result?i.callback(e.result):i.callback("")})})}function l(t,n,r){this.doc="get a url for image href of on this topic",this.reference="http://wiki.freebase.com/wiki/ApiImage";var i=fns.settle_params(arguments,freebase.image,{maxheight:250,maxwidth:250,errorid:"/m/0djw4wd"});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});freebase.get_id(i.q,i.options,function(t){if(!t||!t.id)return i.callback("");var n=[{id:t.id,name:null,"/common/topic/image":[{id:null}]}];freebase.mqlread(n,i.options,function(t){if(!t||!t.result||!t.result[0]||!t.result[0]["/common/topic/image"][0])return i.callback("");var n=e.image_host+t.result[0]["/common/topic/image"][0].id,r=fns.set_params(i.options);return n+="?"+r,i.callback(n)})})}function c(e,t,n){this.doc="get the proper pronoun to use for a topic eg. he/she/they/it";var r=fns.settle_params(arguments,freebase.grammar,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.get_id(r.q,r.options,function(e){if(!e||!e.id)return r.callback({});var n=[{id:e.id,name:null,type:[],"/people/person/gender":[{id:null,optional:!0}],"/fictional_universe/fictional_character/gender":[{id:null,optional:!0}]}];freebase.mqlread(n,t,function(e){if(!e||!e.result||!e.result[0])return r.callback({});e=e.result[0];var t={plural:!1,gender:null,article:"a",pronoun:"it",copula:"is"};if(fns.isin("/people/person",e.type)||fns.isin("/fictional_universe/fictional_character",e.type)){var n=e["/people/person/gender"][0]||e["/fictional_universe/fictional_character/gender"][0];n?n.id=="/en/male"?(t.gender="male",t.pronoun="he"):n.id=="/en/female"&&(t.gender="female",t.pronoun="she"):(t.gender="unknown",t.pronoun="they")}else _.intersection(data.plural_types,e.type).length>0&&(t.plural=!0,t.pronoun="they",t.copula="are"),_.intersection(data.definate_articles,e.type).length>0&&(t.article="the");return r.callback(t)})})}function h(t,n,r){this.doc="turns a url into a freebase topic and list its same:as links";var i=fns.settle_params(arguments,freebase.same_as_links,{});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});var s=e.host+"search?type=/common/topic&limit=1&query="+encodeURIComponent(i.q);fns.http(s,i.options,function(e){if(!e||!e.result||!e.result[0])return i.callback({});freebase.topic(e.result[0].mid,i.options,function(t){if(_.isEmpty(t))return i.callback([]);var n=[];t.property["/common/topic/topic_equivalent_webpage"]&&(n=t.property["/common/topic/topic_equivalent_webpage"].values.map(function(e){return{href:e.value,title:fns.parseurl(e.value).authority}})),t.property["/common/topic/topical_webpage"]&&(n=n.concat(t.property["/common/topic/topical_webpage"].values.map(function(e){var t=fns.parseurl(e.value).authority||"";return{href:e.value,title:t.replace(/^www\./,"")}})));var r={topic:e.result[0],links:n};return i.callback(r)})})}function p(e,t,n){this.doc="return specific language title for a topic",this.reference="http://wiki.freebase.com/wiki/I18n";var r=fns.settle_params(arguments,freebase.translate,{lang:"/lang/fr"});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});r.options.lang.match(/\/lang\//)||(r.options.lang="/lang/"+r.options.lang),freebase.get_id(r.q,r.options,function(e){if(!e||!e.id)return r.callback("");var t=[{id:e.id,name:[{lang:r.options.lang,value:null}]}];freebase.mqlread(t,{},function(e){if(!e||!e.result||!e.result[0])return r.callback("");var t=e.result[0].name||[{}];return t=t[0].value||"",r.callback(t)})})}function d(e,t,n){this.doc="get a topic's notable type";var r=fns.settle_params(arguments,freebase.notable,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.topic(r.q,{filter:"/common/topic/notable_types"},function(e){if(!e||!e.property||!e.property["/common/topic/notable_types"])return r.callback({});var t=e.property["/common/topic/notable_types"]||{values:[]};return t.values[0].name=t.values[0].text,r.callback(t.values[0])})}function v(e,t,n){this.doc="get the first sentence of a topic description",this.reference="http://wiki.freebase.com/wiki/APIText";var r=fns.settle_params(arguments,freebase.sentence,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback(r);fns.description(r.q,r.options,function(e){return e?(e=fns.sentenceparser(e)||[],e=e[0]||"",e=e.replace(/\(.*?\)/g,""),e=e.replace(/  /g," "),r.callback(e)):r.callback("")})}function m(e,t,n){this.doc="get a list of topics in a type";var r=fns.settle_params(arguments,freebase.list,{limit:2e3});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback([]);r.q.match(/\/.{1,12}\/.{3}/)||(r.q=fns.singularize(r.q)),freebase.get_id(r.q,{type:"/type/type"},function(e){if(!e||!e.id)return r.callback([]);var t=[{type:e.id,name:null,id:null,mid:null,limit:100}];if(r.options.extend)for(var n in r.options.extend)t[0][n]=r.options.extend[n];freebase.paginate(t,r.options,r.callback)})}function g(n,r,i){this.doc="from a geo-coordinate, get the town, province, country, and timezone for it",i=i||console.log;if(!n)return i({});r=r||{};if(_.isArray(n)&&n.length>1)return fns.doit_async(n,freebase.place_data,r,i);var s={coordinates:[n.lng,n.lat],type:"Point"},o=[{mid:null,name:null,type:[]}],u=e.geosearch+"?location="+encodeURIComponent(JSON.stringify(s))+"&order_by=distance&limit=1&type=/location/citytown&within=15&format=json&mql_output="+encodeURIComponent(JSON.stringify(o));fns.http(u,r,function(e){var n={city:null,country:null,province:null,timezone:null};n.city=e.result.features[0].properties;var r=[{name:null,id:e.result.features[0].properties.mid,"/location/location/containedby":[{id:null,name:null,type:[],optional:!0,"/location/location/time_zones":[{"/time/time_zone/offset_from_uct":null,id:null,name:null,optional:!0}],"/location/location/containedby":[{id:null,name:null,type:[],optional:!0,"/location/location/time_zones":[{"/time/time_zone/offset_from_uct":null,id:null,name:null,optional:!0}]}]}]}];t(r,{},function(e){for(var t in e.result[0]["/location/location/containedby"]){var r=e.result[0]["/location/location/containedby"][t];r.type.filter(function(e){return e=="/location/country"})[0]?n.country={id:r.id,name:r.name}:r.type.filter(function(e){return e=="/location/administrative_division"})[0]&&(n.province={id:r.id,name:r.name}),r["/location/location/time_zones"][0]&&r["/location/location/time_zones"].length==1&&(n.timezone=r["/location/location/time_zones"][0]);if(n.country)return i(n);r["/location/location/containedby"].map(function(e){e.type.filter(function(e){return e=="/location/country"})[0]?n.country={id:e.id,name:e.name}:!n.province&&e.type.filter(function(e){return e=="/location/administrative_division"})[0]&&(n.province={id:e.id,name:e.name}),!n.timezone&&e["/location/location/time_zones"][0]&&e["/location/location/time_zones"].length==1&&(n.timezone=e["/location/location/time_zones"][0])})}return i(n)})})}function y(e,t,n){this.doc="get any incoming data to this topic, ignoring cvt types";var r=fns.settle_params(arguments,freebase.incoming,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});o(r.q,r.options,function(e){if(!e||!e.id)return r.callback([]);var t=[{id:e.id,"/type/reflect/any_reverse":[{link:null,id:null,name:null,type:"/common/topic",limit:170}]}];a(t,r.options,function(e){return!e||!e[0]||!e[0]["/type/reflect/any_reverse"]?r.callback([]):r.callback(e[0]["/type/reflect/any_reverse"])})})}function b(e,t,n){this.doc="return all outgoing links for a topic, traversing cvt types";var r=fns.settle_params(arguments,freebase.outgoing,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.lookup(r.q,r.options,function(e){if(!e||!e.mid)return r.callback([]);freebase.topic(e.mid,r.options,function(t){if(_.isEmpty(t))return r.callback([]);var n=[];return t.property=fns.kill_boring(t.property),Object.keys(t.property).forEach(function(e){var r=t.property[e];r.valuetype=="object"&&(r.values=r.values.map(function(t){return t.property=e,t}),n=n.concat(r.values)),r.valuetype=="compound"&&r.values.forEach(function(t){t.property=fns.kill_boring(t.property),Object.keys(t.property).forEach(function(r){t.property[r].valuetype=="object"&&(t.property[r].values=t.property[r].values.map(function(t){return t.property=[e,r],t}),n=n.concat(t.property[r].values))})})}),n=n.map(function(e){return{name:e.text,id:e.id,property:e.property}}),n=n.map(function(t){var n=t.property||"";_.isArray(t.property)&&(n=t.property.join("")),t.sentence=e.name+"'s "+_.last(n.split("/")).replace("_"," ")+" is "+t.name;var r=data.sentence_grammars.filter(function(e){return e.id==n})[0]||{};return r.sen&&e.name&&t.name&&(t.sentence=r.sen.replace(/\bsubj\b/,e.name).replace(/\bobj\b/,t.name)),t}),r.callback(n)})})}function w(e,t,n){this.doc="return all outgoing and incoming links for a topic";var r=fns.settle_params(arguments,freebase.graph,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.lookup(r.q,r.options,function(e){if(!e)return r.callback({});delete e.score,delete e.lang,r.options.filter="allproperties",freebase.topic(e.mid,r.options,function(t){if(!t||!t.property)return r.callback([]);var n={},i={};Object.keys(t.property).forEach(function(e){e.match(/^\!/)?i[e]=t.property[e]:n[e]=t.property[e]}),n=fns.parse_topic_api(n),i=fns.parse_topic_api(i);var s=n.map(function(t){return{subject:e,property:{id:t.property},object:t,direction:"outgoing"}});return s=s.concat(i.map(function(t){return{object:e,property:{id:t.property},subject:t,direction:"incoming"}})),s=s.map(function(e){e.property.id=e.property.id.replace(/^\!/,""),delete e.subject.property;var t=data.sentence_grammars.filter(function(t){return t.id==e.property.id})[0]||{};return e.sentence=e.subject.name+"'s "+_.last(e.property.id.split("/")).replace("_"," ")+" is "+e.object.name,t.sen&&e.subject.name&&e.object.name&&(e.sentence=t.sen.replace(/\bsubj\b/,e.subject.name).replace(/\bobj\b/,e.object.name)),e}),r.callback(s)})})}function E(e,t,n){this.doc="get similar topics to a topic";var r=fns.settle_params(arguments,freebase.related,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});var i=[];freebase.outgoing(r.q,r.options,function(e){i=e.filter(function(e){return fns.isin(e.property,data.related_properties)}),i=i.sort(function(e,t){return Math.round(Math.random())-.5}),i=i.map(function(t){return t.sentence||(t.sentence=t.name+" is related to "+e.name),t}),i=fns.json_unique(i,"id");if(i.length>=t.max)return r.callback(i);freebase.notable(r.q,r.options,function(e){return e&&e.id?freebase.list(e.id,{max:r.options.max},function(t){return!t||t==null?r.callback(i):(t=t.map(function(t){return t.sentence=t.name+" is also a "+e.name,t}),i=i.concat(t),i=fns.json_unique(i,"id"),i=i.sort(function(e,t){return Math.round(Math.random())-.5}),r.callback(i))}):r.callback(i)})})}function S(e,t,n){this.doc="get a list of identifiers for a topic";var r=fns.settle_params(arguments,freebase.related,{max:25});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.topic(r.q,r.options,function(e){if(_.isEmpty(e))return r.callback({});var t=e.property["/type/object/type"]||{};return t=t.values||[],t=t.filter(function(e){return!e.text.match(/Topic/)}),t=t.map(function(e){return{name:e.text,id:e.id,property:"/type/object/type"}}),e=fns.parse_topic_api(e.property),e=e.filter(function(e){return fns.isin(e.property,data.is_a)}),e=e.concat(t),r.callback(e)})}function x(e,t,n){this.doc="lookup soft property matches, like 'birthday' vs 'date of birth'";var r=fns.settle_params(arguments,freebase.property_lookup,{type:"/type/property"});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.search(r.q,r.options,function(t){if(!e.match(/\/.*?\/.*?\//)){e=e.toLowerCase(),e=e.replace(/  /," "),e=e.replace(/^\s+|\s+$/,"");var n=fns.singularize(e);t=t.concat(data.properties.filter(function(t){return t.n==e||t.n==n}))}return r.callback(t)})}function T(e,t,n){this.doc="give a topic and a property, and get a list of results";var r=fns.settle_params(arguments,freebase.question,{max:25});if(r.array)return fns.doit_async(r);if(!r.valid||!r.options.property)return r.callback({});var i=r.options.property,s=r.options.property.match(/\/.*?\/.*?\//);if(i.match(/^\/.{1,12}\/.{3}/))return freebase.topic(e,{},function(e){return!e||!e.property||!e.property[i]?r.callback([]):r.callback(e.property[i].values)});var o=fns.metaschema_lookup(i);o?(r.options.filter="(all "+o+':"'+e+'")',freebase.search("",t,function(e){return r.callback(e)})):freebase.property_lookup(i,{},function(e){if(e.length===0)return r.callback([]);r.options.filter=s,freebase.topic(r.q,r.options,function(t){if(_.isEmpty(t))return r.callback({});var n=[];return e.forEach(function(e){t.property[e.id]&&(n=n.concat(t.property[e.id].values))}),n=fns.json_unique(n,"id"),r.callback(n)})})}function N(e,t,n){this.doc="transitive query on a specific property, maximum 3-ply";var r=fns.settle_params(arguments,freebase.property_lookup,{max:25});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});var i=[];freebase.question(r.q,r.options,function(e){return!e||!_.isArray(e)||e.length===0?r.callback(i):(i=i.concat(e),e=e.slice(0,r.options.max).map(function(e){return e.id}),fns.doit_async({q:e,options:r.options,method:freebase.question,callback:function(t){if(!t||!_.isArray(t)||t.length===0)return r.callback(i);i=i.concat(_.flatten(t,"shallow")),i=fns.json_unique(i,"id"),fns.doit_async(e,freebase.question,r.options,function(e){return!e||!_.isArray(e)||e.length===0?r.callback(i):(i=i.concat(_.flatten(e,"shallow")),i=fns.json_unique(i,"id"),r.callback(i))})}}))})}function C(t,n,r){this.doc="list of topics with images";var i=fns.settle_params(arguments,freebase.gallery,{extend:{"/common/topic/image":[{id:null,optional:"required"}]}});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});freebase.list(i.q,i.options,function(t){return t=t.map(function(t){return t.href=e.image_host+_.last(t["/common/topic/image"]).id,t.thumbnail=e.image_host+_.last(t["/common/topic/image"]).id+"?mode=fillcropmid&maxwidth=150&maxheight=150&errorid=/m/0djw4wd",t=freebase.add_widget(t),t}),i.callback(t)})}function k(e,t,n){this.doc="query wordnet via freebase";var r=fns.settle_params(arguments,freebase.wordnet,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});var i=[{id:null,type:"/base/wordnet/synset",gloss:null,syntactic_category:null,sort:["syntactic_category","word.sense_number","a:word.word_number"],word:{sense_number:null,derivationally_related_forms:[{sense:{name:null,id:null},optional:!0}],word:{word:r.q}},"a:word":[{word_number:null,word:{word:null}}]}];r.options.limit&&(i[0].limit=r.options.limit),freebase.mqlread(i,r.options,function(e){return r.callback(e.result)})}function L(e,t,n){this.doc="do a transitive-query, like all rivers in canada, using freebase metaschema";var r=fns.settle_params(arguments,freebase.transitive,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.get_id(r.q,r.options,function(e){if(!e||!e.id)return r.callback({});var n=fns.metaschema_lookup(r.options.property);if(!n)return r.callback([]);t.filter="(all "+n+':"'+e.id+'")',freebase.search("",r.options,function(e){return r.callback(e)})})}function A(e,t,n){this.doc="lat/long for a topic";var r=fns.settle_params(arguments,freebase.geolocation,{type:"/location/location"});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.get_id(r.q,r.options,function(e){if(!e||!e.id)return r.callback({});var t=[{id:e.id,name:null,"/location/location/geolocation":[{latitude:null,longitude:null,type:"/location/geocode",optional:!0}]}];freebase.mqlread(t,r.options,function(e){if(e.result&&e.result[0]&&e.result[0]["/location/location/geolocation"][0]){var t=e.result[0]["/location/location/geolocation"][0];return delete t.type,delete t.optional,r.callback(t)}return r.callback({})})})}function O(t,n,r){this.doc="list of topics nearby a location";var i=fns.settle_params(arguments,freebase.nearby,{});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});freebase.geolocation(i.q,{},function(t){if(!t||!t.latitude||!t.longitude)return i.callback([]);var n='{"coordinates":['+t.longitude+","+t.latitude+'],"type":"Point"}';i.options.within=i.options.within||5,i.options.type=i.options.type||"/location/location";var r=e.geosearch+"?location="+encodeURIComponent(n)+"&order_by=distance&type="+i.options.type+"&within="+i.options.within+"&limit=200&format=json";fns.http(r,i.options,function(e){return i.callback(e.result.features)})})}function M(e,t,n){this.doc="list of topics inside a location";var r=fns.settle_params(arguments,freebase.inside,{property:"part_of"});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});r.options.mql_output=r.options.mql_output||[{name:null,id:null,type:"/location/location","/location/location/geolocation":[{latitude:null,longitude:null,type:"/location/geocode",optional:!0}]}],freebase.transitive(r.q,r.options,function(e){return r.callback(e)})}function D(e,t,n){this.doc="get a url for wikipedia based on this topic";var r=fns.settle_params(arguments,freebase.wikipedia,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.get_id(r.q,r.options,function(e){if(!e||!e.id)return r.callback("");var t=[{id:e.id,name:null,key:{namespace:"/wikipedia/en_title",value:null}}];freebase.mqlread(t,r.options,function(e){return!e||!e.result||!e.result[0]?r.callback(""):r.callback("http://en.wikipedia.org/wiki/"+fns.mql_unencode(e.result[0].key.value))})})}function P(e,t,n){this.doc="get a url for dbpedia based on this topic";var r=fns.settle_params(arguments,freebase.dbpedia,{});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});freebase.get_id(r.q,r.options,function(e){if(!e||!e.id)return r.callback("");var t=[{id:e.id,name:null,key:{namespace:"/wikipedia/en_title",value:null}}];freebase.mqlread(t,r.options,function(e){if(!e||!e.result||!e.result[0])return r.callback({});var t=fns.mql_unencode(e.result[0].key.value),n={html:"http://dbpedia.org/page/"+t,json:"http://dbpedia.org/data/"+t+".json"};return r.callback(n)})})}function H(t,n,r){this.doc="get the wikipedia categories for a topic";var i=fns.settle_params(arguments,freebase.wikipedia_categories,{});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});if(i.q.match(/ /)||i.q.substr(0,1)==i.q.substr(0,1).toLowerCase()||i.q.match(/^\//))return freebase.wikipedia_page(i.q,n,function(e){freebase.wikipedia_categories(e,n,i.callback)});var s=e.wikipedia_host+"?action=query&prop=categories&format=json&clshow=!hidden&cllimit=200&titles="+encodeURIComponent(i.q);fns.http(s,i.options,function(e){if(!e||!e.query||!e.query.pages||!e.query.pages[Object.keys(e.query.pages)[0]])return i.callback([]);var t=e.query.pages[Object.keys(e.query.pages)[0]].categories||[];return t=t.map(function(e){return e.title}),i.callback(t)})}function B(t,n,r){this.doc="outgoing links from this wikipedia page, converted to freebase ids",r=r||console.log;if(!t)return r({});typeof n=="function"&&(r=n,n={}),n=n||{};if(_.isArray(t)&&t.length>1)return fns.doit_async(t,freebase.wikipedia_links,n,r);if(t.match(/ /)||t.substr(0,1)==t.substr(0,1).toLowerCase()||t.match(/^\//))return freebase.wikipedia_page(t,n,function(e){freebase.wikipedia_links(e,n,r)});var i=e.wikipedia_host+"?action=query&prop=links&format=json&plnamespace=0&pllimit=500&titles="+encodeURIComponent(t);fns.http(i,ps.options,function(e){if(!e||!e.query||!e.query.pages||!e.query.pages[Object.keys(e.query.pages)[0]])return r([]);var t=e.query.pages[Object.keys(e.query.pages)[0]].links||[];return t=t.filter(function(e){return e.title.match(/^List of /i)==null}),t=t.map(function(e){return e.id="/wikipedia/en/"+freebase.mql_encode(e.title.replace(/ /g,"_")),e.name=e.title,delete e.title,delete e.ns,e}),r(t)})}function j(t,n,r){this.doc="outgoing links from this wikipedia page, converted to freebase ids",r=r||console.log;if(!t)return r({});typeof n=="function"&&(r=n,n={}),n=n||{};if(_.isArray(t)&&t.length>1)return fns.doit_async(t,freebase.wikipedia_external_links,n,r);if(t.match(/ /)||t.substr(0,1)==t.substr(0,1).toLowerCase()||t.match(/^\//))return freebase.wikipedia_page(t,n,function(e){freebase.wikipedia_external_links(e,n,r)});var i=e.wikipedia_host+"?action=query&prop=extlinks&format=json&plnamespace=0&pllimit=500&titles="+encodeURIComponent(t);fns.http(i,ps.options,function(e){if(!e||!e.query||!e.query.pages||!e.query.pages[Object.keys(e.query.pages)[0]])return r([]);var t=e.query.pages[Object.keys(e.query.pages)[0]].extlinks||[];return t=t.filter(function(e){return e["*"].match(/^http/)}),t=t.map(function(e){var t=fns.parseurl(e["*"]);return{url:e["*"],domain:t.host}}),r(t)})}function F(e,t,n){this.doc="common lookups for types and properties",n=n||console.log;if(!e)return n({});typeof t=="function"&&(n=t,t={}),t=t||{};if(_.isArray(e)&&e.length>1)return fns.doit_async(e,freebase.schema,t,n);freebase.search(e,{type:"/type/type"},function(t){if(t&&t[0]&&t[0].id){t=t[0];var r=[{id:t.id,mid:null,name:null,properties:[{id:null,name:null,"/type/property/reverse_property":[{id:null,name:null,optional:!0}]}],"/freebase/type_hints/mediator":null,"/freebase/type_hints/included_types":[{id:null,name:null}],"/freebase/type_profile/published":null,"/type/type/expected_by":[{id:null,name:null}],"/freebase/type_profile/instance_count":null,"/freebase/type_profile/property_count":null,domain:{id:null,name:null},"/freebase/type_profile/equivalent_topic":{id:null,name:null},type:"/type/type"}];freebase.mqlread(r,{},function(e){if(!e||!e.result||!e.result[0])return n({});e=e.result[0];var t={};t.domain=e.domain,t.id=e.id,t.included_types=e["/freebase/type_hints/included_types"],t.incoming_properties=e["/type/type/expected_by"],t.is_compound_value=e["/freebase/type_hints/mediator"]||!1,t.is_commons=e["/freebase/type_profile/published"]||!1,t.equivalent_topic=e["/freebase/type_profile/equivalent_topic"],t.topic_count=e["/freebase/type_profile/instance_count"]||0,t.property_count=e["/freebase/type_profile/property_count"]||0;var r=[{id:null,name:null,"s:name":{value:null,lang:"/lang/en",optional:"required"},"/freebase/type_hints/included_types":[{id:t.id}]}];freebase.mqlread(r,{},function(e){return!e||!e.result?n(t):(t.included_by=e.result.map(function(e){return{id:e.id,name:e.name}}),n(t))})})}else freebase.property_lookup(e,{},function(e){return!e||!e[0]||!e[0].id?n({}):freebase.property_inspection(e[0].id,{},n)})})}function I(e,t,n){this.doc="common lookups for freebase property data",n=n||console.log;if(!e)return n({});typeof t=="function"&&(n=t,t={}),t=t||{};if(e.hasOwnProperty(e.length)&&e.length>1)return fns.doit_async(e,freebase.property_introspection,t,n);var r=[{id:e,mid:null,name:null,type:"/type/property",reverse_property:[{id:null,name:null,optional:!0}],expected_type:[{id:null,name:null,optional:!0,"/freebase/type_hints/mediator":null}],unique:null,schema:{id:null,name:null,"/freebase/type_profile/instance_count":null,"/freebase/type_hints/mediator":null},"/common/topic/description":null}];freebase.mqlread(r,t,function(r){var i={};if(!r||!r.result||!r.result[0])return n(i);r=r.result[0],i.name=r.name,i.id=r.id,i.type=r.schema,i.description=r["/common/topic/description"],i.unique=r.unique||!1,i.reverse_property=r.reverse_property,i.expected_type=r.expected_type;var s=[{name:null,type:"/base/fbontology/semantic_predicate",paths:{"a:properties":e,"b:properties":[{id:null}]}}];freebase.mqlread(s,t,function(e){return i.meta=e.result,n(i)})})}function q(e,t,n){this.doc="get insight into the breakdown of the topics in this type, by type and quality";var r=fns.settle_params(arguments,freebase.drilldown,{limit:1e3});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback([]);r.q.match(/\/.{1,12}\/.{3}/)||(r.q=fns.singularize(r.q)),fns.get_id(r.q,{type:"/type/type"},function(e){if(!e||!e.id)return r.callback([]);var n=[{"s:type":e.id,type:[],name:null,id:null,limit:150,"estimate-count":null,"/common/topic/image":[{id:null,limit:1,optional:!0}],key:[{namespace:"/wikipedia/en",limit:1,value:null,optional:!0}],"/common/topic/alias":[{value:null,limit:1,optional:!0}]}];if(t.extend)for(var i in t.extend)n[0][i]=t.extend[i]})}function R(e){this.doc="quote a unicode string to turn it into a valid mql /type/key/value";if(!e)return"";e=e.replace(/  /," "),e=e.replace(/^\s+|\s+$/,""),e=e.replace(/ /g,"_");var t="A-Za-z0-9",n="A-Za-z0-9_-",r=new RegExp("^["+t+"]["+n+"]*$"),i=new RegExp("([^"+n+"])","g");if(r.exec(e))return e;var s=function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length==2&&(n="00"+n),n.length==3&&(n="0"+n),"$"+n},o=e.replace(i,s);if(o.charAt(0)=="-"||o.charAt(0)=="_")o=s(o,o.charAt(0))+o.substr(1);return o}function U(t,n,r){function u(t,n){var r=e.wikipedia_host+"?action=query&list=categorymembers&format=json&cmlimit=400&cmtitle="+encodeURIComponent(t)+"&cmcontinue="+n;fns.http(r,i.options,function(e){if(!e||!e.query||!e.query.categorymembers||!e.query.categorymembers[Object.keys(e.query.categorymembers)[0]])return i.callback([]);o=o.concat(e.query.categorymembers.filter(function(e){return e.ns==14}));var n=e["query-continue"]||{};n=n.categorymembers||{},n=n.cmcontinue||"";var r=e.query.categorymembers.filter(function(e){return e.ns==0});r=r.map(function(e){return{id:"/wikipedia/en/"+freebase.mql_encode(e.title),article:"http://en.wikipedia.org/wiki/index.html?curid="+e.pageid,title:e.title}}),s=s.concat(r);if(!n)return i.callback(s);u(t,n)})}this.doc="get the freebase topics in a wikipedia category";var i=fns.settle_params(arguments,freebase.category_list,{depth:1});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});i.q.match(/Category:/)||(i.q="Category:"+i.q);var s=[],o=[];u(i.q,"")}function z(t,n,r){this.doc="find the subcategories of this wikipedia category";var i=fns.settle_params(arguments,freebase.wikipedia_subcategories,{depth:1,already:[]});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});i.q.match(/Category:/)||(i.q="Category:"+i.q);var s=e.wikipedia_host+"?action=query&list=categorymembers&format=json&cmlimit=400&cmnamespace=14&cmtitle="+encodeURIComponent(i.q);fns.http(s,i.options,function(e){if(!e||!e.query||!e.query.categorymembers||!e.query.categorymembers[Object.keys(e.query.categorymembers)[0]])return i.callback([]);var t=e.query.categorymembers.map(function(e){return e.title});return t=t.filter(function(e){return!fns.isin(e,i.options.already)}),i.options.already=fns.compact_strong(i.options.already.concat(t)),i.options.depth>1&&t.length>0?(i.options.depth=i.options.depth-1,freebase.wikipedia_subcategories(t,i.options,function(e){return i.options.already=i.options.already.concat(e),i.callback(fns.compact_strong(i.options.already))})):i.callback(i.options.already)})}function W(t,n,r){this.doc="RDF api",this.reference="http://wiki.freebase.com/wiki/RDF";var i=fns.settle_params(arguments,freebase.topic,{});if(i.array)return fns.doit_async(i);if(!i.valid)return i.callback({});freebase.get_id(i.q,i.options,function(t){var n=t.id;if(!n)return i.callback({});i.options.filter=i.options.filter||"all";var r=e.host+"rdf"+n;fns.http(r,i.options,function(e){return i.callback(e.body||"")})})}function X(e,t,n){this.doc="turn a wikipedia title or url into a freebase topic";var r=fns.settle_params(arguments,freebase.wikipedia_to_freebase,{depth:1});if(r.array)return fns.doit_async(r);if(!r.valid)return r.callback({});r.q=r.q.replace(/^https?:\/\/..\.wikipedia\.org\/wiki\//,"");var i=r.q,s={id:"/wikipedia/en/"+freebase.mql_encode(r.q),title:i};return r.callback(s)}function V(t){this.doc="add a generic html view of a topic";if(!t||!n)return t;var n=t.mid||t.id,r='<a href="#" class="imagewrap" data-id="'+n+'" style="position:relative; width:200px; height:200px;">'+'<img style="border-radius:5px;" src="'+e.image_host+n+'?maxwidth=200&maxheight=200&errorid=/m/0djw4wd"/>';return t.name&&(r+='<div class="caption" style="position:absolute; opacity:0.5; background:black; bottom:10px; color:white; left:10px; border-radius: 5px; min-width:100px; padding:5px;">'+t.name+"</div>"),r+="</a>",t.widget=r,t}function $(e,t,n){n=n||console.log,t=t||{};var r=[];r.push("Freebase.com nodejs-library"),r.push("https://github.com/spencermountain/Freebase-nodejs--");if(e){if(freebase[e]){r.push(" * "+e);var e=new freebase[e];r.push(e.doc);return}r.push("Couldn't find the function "+e+". Here are the available functions:")}Object.keys(freebase).map(function(e){r.push("* **"+e+"** ");var e=new freebase[e](null,{},function(){});r.push("     -"+e.doc)}),t.html?r=r.join("<br/>"):r=r.join("\n"),n(r)}var e={host:"https://www.googleapis.com/freebase/v1/",image_host:"https://usercontent.googleapis.com/freebase/v1/image",geosearch:"http://api.freebase.com/api/service/geosearch",wikipedia_host:"http://en.wikipedia.org/w/api.php",generic_query:{id:null,name:null,mid:null,type:[]}},J={mqlread:["query","mql_read"],topic:["topic_api","all_data","data","everything","get_data"],paginate:["continue","all","each"],same_as_links:["sameas","sameAs","sameaslinks","links","sameas_links","external_links","weblinks"],translate:["translate_to","multilingual","i8n","get_translation"],image:["pic","photo","picture","get_image","image_url","image_src"],description:["get_description","blurb","get_blurb","blurb_api","text","get_text"],notable:["notable_type","notabletype","notable_for","notable_as","main_type","type"],place_data:["city","country","province","place_info","location_info","location","whereis"],incoming:["incoming_links","incoming_nodes","inlinks"],outgoing:["outgoing_links","outgoing_nodes","outlinks"],related:["related_topics","similar","related_to","get_related"],gallery:["images","get_images"],geolocation:["geo","geocoordinates","geo_location","lat_lng","location"],nearby:["near","close_to"],inside:["inside_of","within","contained_by","contains"],mql_encode:["encode","escape"]}}undefined;var http={};if(typeof window!="undefined"&&window.screen){http.get=function(e,t){t=t||defaultcallback,$.get(e,function(e){t(trytoparse(e))}).fail(function(e){t(e.statusText||"error")})},http.jsonp=function(e,t){t=t||defaultcallback,$.getJSON(e,function(e){t(trytoparse(e))}).fail(function(e){t(e.statusText||"error")})},http.post=function(e,t,n){n=n||defaultcallback,$.post(e,t,function(e){n(trytoparse(e))}).fail(function(e){n(e.statusText||"error")})};function defaultcallback(e){console.log(e),$("body").append(JSON.stringify(e))}}else if(typeof module!="undefined"&&module.exports){var request=require("request");http.get=function(e,t){t=t||console.log,request({uri:e},function(e,n,r){t(trytoparse(r))})},http.post=function(e,t,n){n=n||console.log,typeof t=="object"&&(t=JSON.stringify(t)),request({url:"http://api.freebase.com/api/service/mqlread",method:"POST",body:t},function(e,t,r){n(trytoparse(r))})}}typeof define!="undefined"&&define.amd?define([],function(){return http}):typeof module!="undefined"&&module.exports&&(module.exports=http);var data={kill:["/music/track","/music/release_track","/tv/tv_episode","/music/recording","/music/composition","/book/book_edition"],boring:["/type/object/attribution","/type/object/key","/type/object/mid","/common/topic/notable_properties","/type/object/guid","/type/object/type","/type/object/id","/type/object/creator","/type/object/timestamp","/type/object/permission","/common/topic/alias","/common/topic/article","/common/topic/image","/common/topic/notable_for","/common/topic/notable_types","/common/topic/official_website","/common/topic/topic_equivalent_webpage","/common/topic/topical_webpage","/travel/travel_destination_monthly_climate/month","/location/religion_percentage/religion"],sentence_grammars:[],plural_types:["/music/instrument","/business/product_category","/biology/animal","/aviation/aircraft_type","/base/aareas/schema/administrative_area_type","/user/spencermountain/default_domain/type_of_music_group","/geography/geographical_feature_category","/award/award_discipline","/fashion/garment","/interests/collection_category","/organization/organization_type","/geology/rock_type","/sports/sports_equipment","/fictional_universe/fictional_organization_type","/user/jamie/default_domain/retail_category","/base/localfood/produce","/base/disaster2/type_of_injury","/architecture/type_of_museum","/automotive/engine_type","/travel/accommodation_feature","/transportation/bridge_type","/food/type_of_dish","/automotive/automotive_class","/geography/mountain_type","/exhibitions/type_of_exhibition","/user/alecf/recreation/park_feature","/event/disaster_type","/meteorology/cloud","/base/events/type_of_festival","/american_football/football_position","/base/piercings/piercing_location","/religion/type_of_place_of_worship","/base/birdinfo/type_of_diet","/astronomy/type_of_planetographic_feature","/base/forts/type_of_fort","/travel/accommodation_type","/base/crime/lawyer_type","/base/argumentmaps/type_of_joke","/base/events/type_of_performance","/event/type_of_public_presentation","/user/alexander/toys/toy_type","/user/robert/mobile_phones/input_interface","/baseball/baseball_position","/theater/theater_production_staff_role","/soccer/football_position","/music/voice","/base/disaster2/type_of_injury_causing_event","/base/services/exercise_facilities","/conferences/type_of_conference","/base/ecology/type_of_ecosystem","/bicycles/bicycle_type","/basketball/basketball_position","/base/movietheatres/type_of_movie_theatre_cinema","/base/disaster2/type_of_automobile_accident","/ice_hockey/hockey_position","/base/fires/type_of_fire","/base/crime/type_of_criminal_organization","/base/skateboarding/type_of_skateboarding_obstacle","/spaceflight/satellite_type","/base/represent/type_of_agent","/user/rcheramy/default_domain/fruit","/user/rcheramy/default_domain/food","/biology/organism_classification","/business/job_title","/medicine/anatomical_structure","/people/profession","/fictional_universe/character_species","/user/rcheramy/default_domain/hockey_team","/ice_hockey/hockey_team","/sports/sports_team","/sports/professional_sports_team","/base/events/event_presenting_organisation","/film/film_genre","/music/compositional_form","/medicine/drug_class","/geography/lake_type","/user/akatenev/weapons/weapon","/user/spencermountain/default_domain/stock_character","/base/folklore/mythical_creature"],category_like:["/american_football/football_position/players","/architecture/architectural_style/architects","/baseball/baseball_position/players","/basketball/basketball_position/players","/basketball/basketball_roster_position/player","/business/competitive_space_mediator/company","/business/industry/companies","/business/market_share/company","/comic_strips/comic_strip_creator_duration/creator_of_strip","/dining/cuisine/chefs","/dining/cuisine/restaurant","/education/education/student","/education/field_of_study/academic_departments","/education/field_of_study/academics_in_this_field","/film/film_film_company_relationship/film_company","/food/diet/followers","/ice_hockey/hockey_position/players","/interests/hobby/people_with_this_hobby","/interests/interest/people_with_this_interest","/martial_arts/martial_art/well_known_practitioner","/medicine/medical_specialty/hospitals_with_this_specialty","/medicine/medical_specialty/physicians_with_this_specialty","/music/genre/artists","/music/group_membership/member","/music/recording_contribution/contributor","/music/track_contribution/contributor","/olympics/olympic_athlete_affiliation/athlete","/opera/opera_designer_gig/designer","/opera/opera_production_staff_gig/staff_member","/organization/club_interest/clubs","/organization/leadership/person","/organization/organization_board_membership/member","/organization/organization_sector/organizations_in_this_sector","/people/profession/people_with_this_profession","/projects/project_participation/participant","/religion/religion/organizations","/soccer/football_position/players","/sports/pro_sports_played/athlete","/sports/sport/leagues","/sports/sport/officials","/sports/sport/team_coaches","/sports/sport/teams","/sports/sports_team_roster/player","/theater/theater_designer_gig/designer","/theater/theater_production_staff_gig/staff_member","/tv/tv_crew_gig/crewmember","/tv/tv_producer_episode_credit/producer","/tv/tv_producer_term/producer","/tv/tv_regular_personal_appearance/person","/visual_art/visual_art_form/artists","/government/form_of_government/countries","/people/ethnicity/people","/fictional_universe/character_gender","/fictional_universe/fictional_character/ethnicity","/architecture/structure/architectural_style","/book/book/genre","/book/magazine/genre","/book/short_story/genre","/book/written_work/school_or_movement","/broadcast/content/genre","/broadcast/radio_station/format","/comic_books/comic_book_series/genre","/comic_books/comic_book_story/genre","/comic_strips/comic_strip/genre","/computer/software/software_genre","/cvg/computer_videogame/cvg_genre","/film/film/genre","/food/dish/cuisine","/games/game/genre","/internet/website/category","/media_common/netflix_title/netflix_genres","/music/album/genre","/music/music_video/music_video_genre","/opera/opera/genre","/theater/play/genre","/tv/tv_program/genre","/visual_art/artwork/art_genre","/visual_art/artwork/period_or_movement","/automotive/model/model_years","/automotive/model_year/examples","/aviation/aircraft_model/aircraft","/award/recurring_competition/individual_competitions","/conferences/conference_series/conference","/cricket/cricket_series/series_events","/cricket/cricket_tournament/events","/film/film_festival/individual_festivals","/food/dish/recipes","/rail/locomotive_class/locomotives_of_this_class","/sports/sports_championship/events","/sports/tournament_event/competitions","/time/recurring_event/instances","/fictional_universe/character_occupation/characters_with_this_occupation"],related_properties:["/influence/influence_node/influenced_by","/location/location/adjoin_s","/influence/influence_node/influenced","/location/location/coterminous_with","/location/location/near","/time/event/included_in_event","/time/event/includes_event","/film/film/subjects","/film/film/sequel","/film/film/prequel","/film/film/directed_by","/film/film/starring","/book/written_work/previous_in_series","/book/written_work/next_in_series","/book/written_work/subjects","/visual_art/artwork/art_subject","/visual_art/artwork/belongs_to_series","/education/educational_institution/subsidiary_or_constituent_schools","/education/educational_institution/parent_institution","/organization/organization/sectors","/organization/organization/spun_off_from","/organization/organization/spin_offs","/organization/organization/parent","/organization/organization/child","/biology/organism_classification/higher_classification","/biology/organism_classification/lower_classifications","/biology/organism_classification/child_classifications","/biology/organism_classification/parent_classifications","/sports/sports_facility/teams","/sports/sports_league/championship","/sports/sport/leagues","/sports/sports_team/arena_stadium","/sports/sports_team/location","/sports/sports_team_location/teams","/government/political_party/ideology","/government/political_district/elections","/government/election/winner","/music/track/artist","/time/recurring_event/instances","/people/profession/specializations","/people/profession/specialization_of","/music/artist/label","/music/artist/album","/music/release/label","/music/release/album","/music/album/artist","/music/musical_group/member","/music/producer/releases_produced","/base/onephylogeny/type_of_thing/includes","/base/onephylogeny/type_of_thing/included_in","/location/country/capital","/location/country/form_of_government","/location/country/currency_used","/location/country/national_anthem","/aviation/airport/serves","/architecture/structure/architect","/geography/lake/cities","/geography/lake/outflow","/geography/lake/inflow","/olympics/olympic_games/host_city","/olympics/olympic_host_city","/business/employment_tenure/company","/film/performance/film","/tv/regular_tv_appearance/series","/people/marriage/spouse","/education/education/specialization","/education/education/major_field_of_study","/location/adjoining_relationship/adjoins","/music/group_membership/group","/celebrities/friendship/friend","/base/popstra/friendship/participant","/people/person/parents","/influence/influence_node/peers","/people/person/children","/people/sibling_relationship/sibling","/location/location/contains"],definate_articles:["/geography/mountain_range","/location/region","/royalty/noble_title","/user/pak21/default_domain/tectonic_plate","/education/university","/education/department","/religion/religious_organization","/user/robinboast/default_domain/historical_period","/travel/tourist_attraction","/comic_books/comic_book_character","/transportation/bridge","/business/shopping_center","/base/argumentmaps/intellectual_dispute","/base/argumentmaps/argument","/geography/island_group"],properties:[],is_a:["/amusement_parks/ride/ride_type","/amusement_parks/roller_coaster/propulsion","/amusement_parks/roller_coaster/train_configuration","/architecture/building/building_function","/architecture/museum/type_of_museum","/astronomy/asteroid/spectral_type","/astronomy/celestial_object/category","/astronomy/extraterrestrial_location/type_of_planetographic_feature","/astronomy/galaxy/galaxy_classification_hubble","/astronomy/galaxy_classification_code/galaxy_shape","/astronomy/near_earth_object/near_earth_object_classification","/astronomy/orbital_relationship/orbit_type","/astronomy/star/spectral_type","/astronomy/telescope/type_of_telescope","/automotive/model/automotive_class","/automotive/transmission/classification","/aviation/aircraft_model/aircraft_type","/aviation/airliner_accident/accident_type","/aviation/airport/airport_type","/aviation/aviation_waypoint/waypoint_type","/award/competition/type_of_competition","/bicycles/bicycle_model/bicycle_type","/biology/breed_registration/breed_group","/biology/fossil_specimen/organism","/biology/gene_group_membership/group","/biology/gene_ontology_group/group_type","/biology/organism/organism_type","/biology/organism/sex","/biology/organism_classification/rank","/biology/pedigreed_animal/breed","/boats/ship/ship_class","/boats/ship_class/ship_type","/book/book_edition/binding","/book/periodical_format_period/format","/book/poem/verse_form","/book/short_non_fiction/mode_of_writing","/business/consumer_product/category","/business/issue/type_of_issue","/business/product_line/category","/celebrities/sexual_orientation_phase/sexual_orientation","/chemistry/chemical_compound/classifications","/chemistry/chemical_element/chemical_series","/chemistry/chemical_element/periodic_table_block","/computer/computer_peripheral/peripheral_class","/computer/file_format/genre","/conferences/conference_series/type_of_conference","/cricket/cricket_match/match_type","/cvg/computer_videogame/gameplay_modes","/digicams/digital_camera/format","/distilled_spirits/blended_spirit/style","/distilled_spirits/distilled_spirit/spirit_type","/distilled_spirits/infused_spirit/infusion_style","/education/educational_institution/school_type","/education/fraternity_sorority/fraternity_sorority_type","/engineering/battery/cell_type","/engineering/battery/size","/engineering/battery_size/shape_format","/engineering/engine/category","/engineering/piston_engine/cooling_method","/engineering/piston_engine/fuel_delivery_method","/engineering/piston_engine/piston_configuration","/engineering/piston_engine/valvetrain_configuration","/engineering/power_plug_standard/plug_type","/event/disaster/type_of_disaster","/event/speech_or_presentation/type_or_format_of_presentation","/exhibitions/exhibition/exhibition_types","/fashion/textile/weave","/fictional_universe/fictional_setting/setting_type","/film/film/film_format","/food/beer/beer_style","/food/beer_style/bjcp_style_category","/food/cheese/texture","/food/dish/type_of_dish1","/food/drinking_establishment/drinking_establishment_type","/food/tea/tea_type","/food/wine_style/wine_types","/geography/geographical_feature/category","/geography/glacier/glacier_type","/geography/lake/lake_type","/geography/mountain/listings","/geography/mountain/mountain_type","/geography/waterfall/waterfall_type","/government/government_office_or_title/category","/government/government_position_held/basic_title","/interests/collectable_item/collection_category","/internet/top_level_domain/domain_type","/language/conlang/conlang_type","/language/language_writing_system/type_of_writing","/law/us_patent/international_classification","/law/us_patent/us_classification_category","/law/us_patent/us_patent_type","/location/administrative_division_capital_relationship/capital_type","/location/country/form_of_government","/location/location_symbol_relationship/Kind_of_symbol","/martial_arts/martial_art/category","/medicine/cancer_center/cancer_center_type","/medicine/drug/drug_class","/medicine/drug/mechanism_of_action","/medicine/drug_formulation/dosage_form","/medicine/drug_formulation/drug_category","/medicine/hospital_ownership/ownership_status","/medicine/infectious_disease/infectious_agent_type","/medicine/medical_trial/design","/medicine/medical_trial/phase","/medicine/medical_trial/type_of_trial","/meteorology/cloud/classification","/meteorology/tropical_cyclone/category","/metropolitan_transit/transit_line/service_type","/military/military_unit/unit_size","/music/album/release_type","/music/composition/form","/music/opera_singer/voice_type","/music/release/format","/organization/organization/legal_structure","/organization/organization/organization_type","/people/person/ethnicity","/people/person/gender","/physics/particle/family","/physics/particle/generation","/protected_sites/natural_or_cultural_site_designation/categories","/protected_sites/natural_or_cultural_site_listing/designation","/protected_sites/protected_site/iucn_category","/rail/locomotive_class/gauge","/rail/railway_gauge_relationship/gauge","/rail/railway_type_relationship/railway_type","/rail/steam_locomotive_class/fuel_type","/rail/steam_locomotive_class/wheel_configuration","/religion/place_of_worship/religion","/religion/place_of_worship/type_of_place_of_worship","/religion/place_of_worship_historical_use/religion","/religion/religious_leadership_jurisdiction/size_or_type","/royalty/chivalric_rank/gender","/royalty/noble_rank/gender","/royalty/order_of_chivalry/category","/skiing/lift_tenure/lift_type","/skiing/ski_run/rating","/spaceflight/bipropellant_rocket_engine/engine_cycle","/spaceflight/rocket/rocket_function","/spaceflight/satellite/primary_use","/sports/boxer/weight_division","/time/holiday/type_of_holiday","/transportation/bridge/bridge_type","/travel/accommodation/accommodation_type","/visual_art/artwork/art_form","/wine/wine/color","/wine/wine/wine_style","/wine/wine/wine_type","/zoos/zoo/category","/people/person/profession","/soccer/football_player/position_s","/american_football/football_historical_roster_position/position_s","/american_football/football_player/position_s","/american_football/football_roster_position/position","/baseball/baseball_player/position_s","/baseball/baseball_roster_position/position","/basketball/basketball_player/position_s","/basketball/basketball_roster_position/position","/ice_hockey/hockey_player/hockey_position","/ice_hockey/hockey_roster_position/position","/soccer/football_player/position_s","/soccer/football_roster_position/position"]};typeof define!="undefined"&&define.amd?define([],function(){return data}):typeof module!="undefined"&&module.exports&&(module.exports={data:data});if(typeof module!="undefined"&&module.exports)var _=require("underscore"),async=require("async"),data=require("./data.js").data,http=require("./http.js");var async_max=10,fns={},globals={host:"https://www.googleapis.com/freebase/v1/",image_host:"https://usercontent.googleapis.com/freebase/v1/image",geosearch:"http://api.freebase.com/api/service/geosearch",wikipedia_host:"http://en.wikipedia.org/w/api.php"};fns.compact_strong=function(e){return _.unique(_.compact(e)).filter(function(e){return _.isEmpty(e)==0})},fns.settle_params=function(e,t,n){var r={valid:!1,q:e[0],options:e[1]||{},callback:e[2]||console.log,defaults:n||{},method:t||""};typeof r.options=="function"&&(r.callback=r.options,r.options={});if(r.options.verbose){var i=r.callback;r.callback=function(e){return console.log("hi"),i(e)}}if(_.isArray(r.q)){if(r.q.length>1)return r.q=fns.compact_strong(r.q),r.valid=!0,r.array=!0,r;r.q=r.q[0]}_.isObject(r.q)&&(r.q=r.q.id||r.q.mid||r.q.name);if(typeof r.q!="string"||typeof r.options!="object"||typeof r.callback!="function")return r;r.q.match(/\/.*?\/.*?/)&&(r.is_id=!0);for(var s in r.defaults)r.options[s]=r.options[s]||r.defaults[s];return r.q=r.q.replace(/  /," "),r.q=r.q.replace(/^\s+|\s+$/,""),r.q.match(/^(https?:\/\/|www\.)/)&&(r.q=r.q.replace(/\/$/,""),r.q=r.q.replace(/^https/,"http"),r.url=!0),r.valid=!0,r},fns.topk=function(e,t){var n=[];t=t||1;var r={},i=e.length-1;for(var i;i>-1;i--){var s=e[i];r[s]==null?r[s]=1:r[s]++}for(var s in r)n.push(s);return n.sort(function(e,t){return r[t]-r[e]}).map(function(e){return{value:e,count:r[e],percentage:(r[e]/t*100).toFixed(2)}})},fns.percentage=function(e,t){return parseInt(e/t*100)},fns.kill_boring=function(e){return e?(data.boring.forEach(function(t){delete e[t]}),e):{}},fns.parse_topic_api=function(e,t){var n=[];return e=fns.kill_boring(e),Object.keys(e).forEach(function(t){var r=e[t];r.valuetype=="object"&&(r.values=r.values.map(function(e){return e.property=t,e}),n=n.concat(r.values)),r.valuetype=="compound"&&r.values.forEach(function(e){e.property=fns.kill_boring(e.property),Object.keys(e.property).forEach(function(r){e.property[r].valuetype=="object"&&(e.property[r].values=e.property[r].values.map(function(e){return e.property=[t,r],e}),n=n.concat(e.property[r].values))})})}),n=n.map(function(e){return{name:e.text,id:e.id,property:e.property}}),n=n.map(function(e){return _.isArray(e.property)&&(e.property=e.property.join("")),e}),n},fns.metaschema_lookup=function(e){e=e.toLowerCase(),e=e.replace(/\W(is|was|are|will be|has been)\W/," "),e=e.replace(/  /g," "),e=e.replace(/_/g," "),e=e.replace(/^\s+|\s+$/,"");var t=data.metaschema.filter(function(t){return t.aliases=t.aliases||[],t.id==e||t.name.toLowerCase()==e||fns.isin(e,t.aliases)||t.search.replace(/_/g," ")==e})[0];return t=t||{},t.search},fns.singularize=function(e){function l(e,t){return e.length>=t.length&&e.substring(e.length-t.length)==t}function c(e,t){if(typeof e=="string"){var n=t.charAt(0).toLowerCase()!=t.charAt(0);return n?e.charAt(0).toUpperCase()+e.substr(1):e}var r=[];for(var i in e){var s=e[i];r.push(c(s,t))}return r}function h(e,t,n){return e.substring(0,e.length-t.length)+n}function p(e,t){return t.indexOf(e)>=0}function d(e){return p(e,"aeiou")}if(e.match(" ")){var t=e.split(" "),n=t[t.length-1],r=t.slice(0,-1);return r.join(" ")+" "+fns.singularize(n)}var i={about:1,above:1,across:1,after:1,against:1,along:1,among:1,around:1,at:1,before:1,behind:1,below:1,beneath:1,beside:1,between:1,beyond:1,but:1,by:1,despite:1,down:1,during:1,except:1,"for":1,from:1,"in":1,inside:1,into:1,like:1,near:1,of:1,off:1,on:1,onto:1,out:1,outside:1,over:1,past:1,since:1,through:1,throughout:1,till:1,to:1,toward:1,under:1,underneath:1,until:1,up:1,upon:1,"with":1,within:1,without:1},s=[{p:"people",s:"person"},{p:"tornadoes",s:"tornado"},{p:"churches",s:"church"},{p:"countries",s:"country"},{p:"cities",s:"city"},{p:"companies",s:"company"},{p:"monkies",s:"monkey"},{p:"donkies",s:"donkey"},{p:"mysteries",s:"mystery"},{p:"authors",s:"author"}],o={beef:{anglicized:"beefs",classical:"beeves"},brother:{anglicized:"brothers",classical:"brethren"},child:{anglicized:null,classical:"children"},cow:{anglicized:null,classical:"kine"},ephemeris:{anglicized:null,classical:"ephemerides"},genie:{anglicized:null,classical:"genii"},money:{anglicized:"moneys",classical:"monies"},mongoose:{anglicized:"mongooses",classical:null},mythos:{anglicized:null,classical:"mythoi"},octopus:{anglicized:"octopuses",classical:"octopodes"},ox:{anglicized:null,classical:"oxen"},soliloquy:{anglicized:"soliloquies",classical:null},trilby:{anglicized:"trilbys",classical:null}},u=["fish","ois","sheep","deer","pox","itis"],a={bison:1,flounder:1,pliers:1,bream:1,gallows:1,proceedings:1,breeches:1,graffiti:1,rabies:1,britches:1,headquarters:1,salmon:1,carp:1,herpes:1,scissors:1,chassis:1,"high-jinks":1,"sea-bass":1,seabass:1,clippers:1,homework:1,series:1,cod:1,innings:1,shears:1,contretemps:1,jackanapes:1,species:1,corps:1,mackerel:1,swine:1,debris:1,measles:1,trout:1,diabetes:1,mews:1,tuna:1,djinn:1,mumps:1,whiting:1,eland:1,news:1,wildebeest:1,elk:1,pincers:1,moose:1,shrimp:1,"hoi polloi":1,riffraff:1,rabble:1},f=[{from:"a",to:"ae",words:["alumna","alga","vertebra"]},{from:"a",anglicized:"as",classical:"ae",words:["abscissa","amoeba","antenna","aurora","formula","hydra","hyperbola","lacuna","medusa","nebula","nova","parabola"]},{from:"a",anglicized:"as",classical:"ata",words:["anathema","bema","carcinoma","charisma","diploma","dogma","drama","edema","enema","enigma","gumma","lemma","lymphoma","magma","melisma","miasma","oedema","sarcoma","schema","soma","stigma","stoma","trauma"]},{from:"en",anglicized:"ens",classical:"ina",words:["stamen","foramen","lumen"]},{from:"ex",to:"ices",words:["codex","murex","silex"]},{from:"ex",anglicized:"exes",classical:"ices",words:["apex","cortex","index","latex","pontifex","simplex","vertex","vortex"]},{from:"is",anglicized:"ises",classical:"ides",words:["iris","clitoris"]},{from:"o",to:"os",words:["albino","archipelago","armadillo","commando","ditto","dynamo","embryo","fiasco","generalissimo","ghetto","guano","inferno","jumbo","lingo","lumbago","magneto","manifesto","medico","octavo","photo","pro","quarto","rhino","stylo"]},{from:"o",anglicized:"os",classical:"i",words:["alto","basso","canto","contralto","crescendo","solo","soprano","tempo"]},{from:"on",to:"a",words:["aphelion","asyndeton","criterion","hyperbaton","noumenon","organon","perihelion","phenomenon","prolegomenon"]},{from:"um",to:"a",words:["agendum","bacterium","candelabrum","datum","desideratum","erratum","extremum","stratum","ovum"]},{from:"um",anglicized:"ums",classical:"a",words:["aquarium","compendium","consortium","cranium","curriculum","dictum","emporium","enconium","gymnasium","honorarium","interregnum","lustrum","maximum","medium","memorandum","millenium","minimum","momentum","optimum","phylum","quantum","rostrum","spectrum","speculum","stadium","trapezium","ultimatum","vacuum","velum"]},{from:"us",anglicized:"uses",classical:"i",words:["focus","fungus","genius","incubus","nimbus","nucleolus","radius","stylus","succubus","torus","umbilicus","uterus"]},{from:"us",anglicized:"uses",classical:"us",words:["apparatus","cantus","coitus","hiatus","impetus","nexus","plexus","prospectus","sinus","status"]},{from:"",to:"i",words:["afreet","afrit","efreet"]},{from:"",to:"im",words:["cherub","goy","geraph"]}],v=e.toLowerCase();for(var m in s)if(s[m].p==e)return s[m].s;for(var g in o){var y=o[g];if(y.anglicized===v||y.classical===v)return c(g,e)}for(var b in u)if(l(v,b))return e;if(a&&a[v])return e;var w=function(t,n,r){if(l(e,n)){var i=e.substring(e.length-n.length),s=i+y.from;for(var o in r)if(s===o)return c(s,e)}return null};for(var E in f){var y=f[E],S="to"in y&&w(y.from,y.to,y.words)||"anglicized"in y&&w(y.from,y.anglicized,y.words)||"classical"in y&&w(y.from,y.classical,y.words);if(S!=null&&typeof S=="string")return S}for(var x in i){var T=e.indexOf(" "+x+" ");if(T>0){var N=e.substring(0,T),C=singularize(N);return C!=null?C+" "+x+" "+e.substr(T+x.length+2):null}T=e.indexOf("-"+x+"-");if(T>0){var N=e.substring(0,T),C=singularize(N);return C!=null?C+"-"+x+"-"+e.substr(T+x.length+2):null}}var k=e.lastIndexOf(" ");if(k>0){var C=singularize(e.substring(k+1));return C!=null?e.substring(0,k+1)+C:null}return l(e,"xes")||l(e,"ses")?e.substring(0,e.length-2):l(e,"s")&&!l(e,"ss")?e.substring(0,e.length-1):e},fns.sentenceparser=function(e){var t=e.split(/(\S.+?[.])(?=\s+|$)/g),n=[];for(var r in t)t[r]&&(t[r]=t[r].replace(/^\s+|\s+$/g,""),t[r].match(/(^| )(mr|dr|llb|md|bl|phd|ma|ba|mrs|miss|misses|mister|sir|esq|mstr|jr|sr|st|lit|inc|fl|ex|eg|jan|feb|mar|apr|jun|aug|sept?|oct|nov|dec)\. ?$/i)||t[r].match(/[ |\.][a-z]\.?$/i)?t[parseInt(r,10)+1]=t[r]+" "+t[parseInt(r,10)+1]:(n.push(t[r]),t[r]=""));var i=[];for(var s in n)n[s]=n[s].replace(/^\s+|\s+$/g,""),n[s]&&i.push(n[s]);return i},fns.json_unique=function(e,t){var n=[];e:for(var r=0;r<e.length;r++){for(var i=0;i<n.length;i++)if(n[i]&&e[r]&&n[i][t]==e[r][t])continue e;n[n.length]=e[r]}return n},fns.doit_async=function(e){e.q=e.q||[];var t=e.q.map(function(t,n){return{q:t,options:e.options,method:e.method}}),n=function(e,t){e.method(e.q,e.options,function(e){t(null,e)})};async.mapLimit(t,async_max,n,function(t,n){return e.callback(n)})},fns.mql_unencode=function(e){return e=e.replace(/\$([0-9A-Fa-f]{4})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}),e},fns.groups_of=function(e,t){var n=[];for(var r in e)r%t===0?n.push([e[r]]):n[n.length-1].push(e[r]);return n},fns.parseurl=function(e){var t={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;while(i--)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r},fns.set_params=function(e){var t=e;return t?Object.keys(t).map(function(e){var n=t[e];if(_.isArray(t[e])||_.isObject(t[e]))n=encodeURIComponent(JSON.stringify(t[e]));return e+"="+n}).join("&"):""},fns.clone=function(e){return JSON.parse(JSON.stringify(e))},fns.http=function(e,t,n){t.key&&(e+="&key="+t.key),http.get(e,n)},fns.post=function(e,t,n){var r="query="+JSON.stringify({query:e,key:t.key,cursor:t.cursor});http.post("http://api.freebase.com/api/service/mqlread",r,n)},fns.isin=function(e,t){return t.some(function(t){return t==e})},typeof define!="undefined"&&define.amd?define([],function(){return fns}):typeof module!="undefined"&&module.exports&&(module.exports=fns);if(typeof module!="undefined"&&module.exports)var async=require("./client_side/async"),fns=require("./helpers.js"),data=require("./data.js").data;typeof define!="undefined"&&define.amd?define([],function(){return freebase}):typeof module!="undefined"&&module.exports&&(module.exports=freebase)